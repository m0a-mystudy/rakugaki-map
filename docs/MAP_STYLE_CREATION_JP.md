# カスタムグレースケールマップスタイルの作成

このガイドでは、rakugaki-mapアプリケーション用のカスタムグレースケールマップスタイルをGoogle Cloud Consoleで作成する方法を説明します。

## 概要

Google Maps Platformはクラウドベースのマップスタイリングをサポートしており、アプリケーションコードを変更せずにカスタムマップの外観を作成できます。作成されたマップスタイルは、アプリケーション内でマップIDを使用して参照されます。

## 前提条件

- rakugaki-mapプロジェクトのGoogle Cloud Consoleへのアクセス権
- Google Maps Platform APIが有効（Terraformで管理）
- プロジェクトで課金が有効

## 手順

### 1. Google Cloud ConsoleでMap Stylesにアクセス

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. プロジェクトを選択：`rakugakimap-dev` または `the-rakugaki-map`
3. **APIs & Services** > **Maps Platform** > **Map Styles**に移動
   - またはコンソール検索バーで「Map Styles」を検索

### 2. 新しいマップスタイルを作成

1. **Create Map Style**ボタンをクリック
2. **Create a style**を選択（インポートではなく）
3. プラットフォームとして**JavaScript**を選択
4. わかりやすい名前を付ける：`Rakugaki Grayscale Style`

### 3. グレースケール設定の構成

スタイルエディターで、クリーンなグレースケール外観のために以下の設定を適用：

#### グローバル設定
- **全体の彩度**: `-100`に設定（すべての色を除去）
- **明度**: 視認性向上のため`+10`から`+20`に調整

#### 特定の機能のスタイリング
主要な機能カテゴリに以下を適用：

**道路:**
- **すべての道路**: 彩度`-100`, 明度`0`から`+10`
- **高速道路**: 彩度`-100`, 明度`-10`（コントラスト用に暗く）

**水域:**
- **水**: 彩度`-100`, 明度`-20`（濃い青 → 濃いグレー）

**ランドスケープ:**
- **自然地形**: 彩度`-100`, 明度`+5`
- **人工物**: 彩度`-100`, 明度`-5`

**POI（興味のあるポイント）:**
- **すべてのPOI**: 彩度`-100`, 視認性を`50%`に減らしてクリーンな見た目に

**ラベル:**
- **すべてのラベル**: 彩度`-100`, 良いコントラストを確保

### 4. プレビューとテスト

1. プレビューパネルを使用して、異なるズームレベルでスタイルをテスト
2. 異なるマップ位置（都市部、郊外、沿岸部）でテスト
3. テキストラベルが読みやすいことを確認
4. 背景に対する描画の視認性を確認

### 5. マップIDの作成と関連付け

1. スタイルに満足したら**Publish**をクリック
2. Google Cloud Consoleの**Map IDs**セクションに移動
3. **Create Map ID**をクリック
4. マップIDを設定：
   - **Map ID name**: `rakugaki-grayscale-map-{environment}`
   - **Map type**: `JavaScript`
   - **Description**: `Rakugaki描画アプリ用グレースケールマップスタイル ({environment})`
5. **公開したスタイルをこのマップIDに関連付け**

### 6. GitHub Variablesの更新

1. Google Cloud Consoleから生成されたマップIDをコピー
2. GitHubリポジトリ変数を更新：

```bash
# 開発環境用
gh variable set MAP_ID_DEV --body "your-dev-map-id-here"

# 本番環境用
gh variable set MAP_ID_PROD --body "your-prod-map-id-here"
```

### 7. ローカル開発環境の更新

`.env.local`ファイルを更新：

```bash
VITE_MAP_ID=your-dev-map-id-here
```

## 推奨グレースケールスタイル設定

描画の視認性を最適化するため、以下の特定の調整を検討してください：

```json
{
  "elementType": "all",
  "stylers": [
    { "saturation": -100 },
    { "lightness": 15 }
  ]
},
{
  "featureType": "water",
  "stylers": [
    { "saturation": -100 },
    { "lightness": -25 }
  ]
},
{
  "featureType": "road",
  "stylers": [
    { "saturation": -100 },
    { "lightness": 5 }
  ]
}
```

## カスタムマップスタイルのテスト

1. 新しいマップIDでアプリケーションをデプロイ
2. 異なる色とツールで描画をテスト
3. 回転とチルト機能がまだ動作することを確認
4. 異なるズームレベルでの視認性をチェック

## トラブルシューティング

**マップが読み込まれない：**
- マップIDが正しくコピーされているか確認
- マップIDが公開されたスタイルに関連付けられているか確認
- APIキーの制限に正しいドメインが含まれているかチェック

**スタイルが表示されない：**
- スタイルが公開されている（ドラフトではない）ことを確認
- ブラウザキャッシュをクリアしてリロード
- マップIDが正しく関連付けられているか確認

**回転/チルトが動作しない：**
- マップIDがJavaScriptプラットフォーム用に設定されているか確認
- マップオプションで`renderingType: 'VECTOR'`が設定されているか確認

## カスタムマップスタイルの利点

- **一貫したブランディング**: アプリケーションのビジュアルデザインに合わせる
- **描画視認性の向上**: 描画のコントラストのために背景を最適化
- **コード更新不要**: アプリケーションを再デプロイせずにスタイルを変更
- **パフォーマンス**: クラウドベースのスタイルは効率的に読み込まれる

## 今後の機能拡張

複数のマップスタイルの作成を検討：
- **ハイコントラスト**: アクセシビリティ用
- **ナイトモード**: 明るい描画を持つダークテーマ
- **ミニマル**: 描画に集中するための非常にクリーンで最小限の機能

各スタイルは独自のマップIDを持ち、プログラム的にまたはユーザー設定を通じて切り替えることができます。

## 現在の実装

アプリケーションは環境に基づいて適切なマップIDを自動的に使用します：
- **ローカル開発**: `.env.local`の`VITE_MAP_ID`を使用
- **開発環境デプロイ**: GitHub変数`MAP_ID_DEV`を使用
- **本番環境デプロイ**: GitHub変数`MAP_ID_PROD`を使用
- **フォールバック**: 環境変数が設定されていない場合、デモマップID `8e0a97af9e0a7f95`を使用
