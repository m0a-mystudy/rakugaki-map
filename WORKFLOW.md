# é–‹ç™ºãƒ»é‹ç”¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Rakugaki Mapãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é–‹ç™ºãƒ»é‹ç”¨ã«ãŠã‘ã‚‹ä½œæ¥­ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ–¹é‡ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

## åŸºæœ¬æ–¹é‡

### 1. ç’°å¢ƒåˆ†é›¢
- **é–‹ç™ºç’°å¢ƒ** (`rakugakimap-dev`): é–‹ç™ºãƒ»æ¤œè¨¼ãƒ»ãƒ†ã‚¹ãƒˆç”¨
- **æœ¬ç•ªç’°å¢ƒ** (`the-rakugaki-map`): å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã‚µãƒ¼ãƒ“ã‚¹
- **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒ**: Pull Requestæ¯ã«è‡ªå‹•ä½œæˆï¼ˆ7æ—¥é–“ã®ä¸€æ™‚ç’°å¢ƒï¼‰

### 2. ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥
- **`main`ãƒ–ãƒ©ãƒ³ãƒ**: é–‹ç™ºç’°å¢ƒã¸ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾è±¡
- **ã‚¿ã‚° (`v*.*.*`)**: æœ¬ç•ªç’°å¢ƒã¸ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãƒˆãƒªã‚¬ãƒ¼
- **Pull Request**: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒã§ã®æ¤œè¨¼

### 3. ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†åˆ†é›¢
- **Terraformç®¡ç†**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ãƒ•ãƒ©ï¼ˆAPIã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€èªè¨¼è¨­å®šï¼‰
- **æ‰‹å‹•ç®¡ç†**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç›¤ï¼ˆWIFã€Secret Managerã€ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚±ãƒƒãƒˆï¼‰

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è©³ç´°

### ğŸ”„ æ—¥å¸¸é–‹ç™ºãƒ•ãƒ­ãƒ¼

#### 1. æ©Ÿèƒ½é–‹ç™º
```bash
# 1. æœ€æ–°ã®mainãƒ–ãƒ©ãƒ³ãƒã‚’å–å¾—
git checkout main
git pull origin main

# 2. æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
git checkout -b feature/new-feature

# 3. é–‹ç™ºä½œæ¥­
npm run dev  # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
# ã‚³ãƒ¼ãƒ‰ç·¨é›†ãƒ»ãƒ†ã‚¹ãƒˆ

# 4. ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥
git add .
git commit -m "feat: add new feature"
git push origin feature/new-feature
```

#### 2. Pull Requestä½œæˆ
```bash
# GitHubä¸Šã§Pull Requestä½œæˆ
# â†’ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒãŒè‡ªå‹•ä½œæˆã•ã‚Œã‚‹
# â†’ CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã‚‹
```

#### 3. ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ãƒãƒ¼ã‚¸
```bash
# ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾Œã€mainãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸
# â†’ é–‹ç™ºç’°å¢ƒã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
```

### ğŸš€ ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼

#### 1. é–‹ç™ºç’°å¢ƒã§ã®æœ€çµ‚ç¢ºèª
```bash
# é–‹ç™ºç’°å¢ƒã§ã®å‹•ä½œç¢ºèª
# https://rakugakimap-dev.web.app

# å¿…è¦ã«å¿œã˜ã¦ä¿®æ­£ãƒ»è¿½åŠ ã‚³ãƒŸãƒƒãƒˆ
```

#### 2. æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹
```bash
# mainãƒ–ãƒ©ãƒ³ãƒã§æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹ç”¨ã‚¿ã‚°ä½œæˆ
git checkout main
git pull origin main
git tag v1.0.0
git push origin v1.0.0

# â†’ æœ¬ç•ªç’°å¢ƒã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
# â†’ https://the-rakugaki-map.web.app
```

### âš™ï¸ ã‚¤ãƒ³ãƒ•ãƒ©å¤‰æ›´ãƒ•ãƒ­ãƒ¼

#### 1. Terraformç®¡ç†ãƒªã‚½ãƒ¼ã‚¹ã®å¤‰æ›´

**é–‹ç™ºç’°å¢ƒã§ã®å¤‰æ›´**:
```bash
# 1. é–‹ç™ºç’°å¢ƒã§å¤‰æ›´ã‚’ãƒ†ã‚¹ãƒˆ
cd terraform/environments/dev
terraform plan
terraform apply

# 2. å‹•ä½œç¢ºèª
npm run dev  # ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆ
# é–‹ç™ºç’°å¢ƒ (rakugakimap-dev.web.app) ã§ãƒ†ã‚¹ãƒˆ

# 3. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
git add terraform/
git commit -m "feat: update terraform configuration"
git push origin feature/terraform-update
```

**æœ¬ç•ªç’°å¢ƒã¸ã®é©ç”¨**:
```bash
# 1. Pull Requestãƒãƒ¼ã‚¸å¾Œ
# â†’ CI/CDã§é–‹ç™ºç’°å¢ƒã®TerraformãŒè‡ªå‹•å®Ÿè¡Œ

# 2. æœ¬ç•ªç’°å¢ƒã§ã‚‚åŒæ§˜ã®å¤‰æ›´ã‚’é©ç”¨
cd terraform/environments/prod
terraform plan
terraform apply

# 3. æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
git tag v1.0.1
git push origin v1.0.1
```

#### 2. æ‰‹å‹•ç®¡ç†ãƒªã‚½ãƒ¼ã‚¹ã®å¤‰æ›´

**Secret Manager**:
```bash
# æ–°ã—ã„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè¿½åŠ 
gcloud secrets create new-secret --project=rakugakimap-dev
echo "secret-value" | gcloud secrets versions add new-secret --data-file=- --project=rakugakimap-dev

# æœ¬ç•ªç’°å¢ƒã«ã‚‚åŒæ§˜ã«é©ç”¨
gcloud secrets create new-secret --project=the-rakugaki-map
echo "secret-value" | gcloud secrets versions add new-secret --data-file=- --project=the-rakugaki-map
```

**Workload Identity Federation**:
```bash
# WIFè¨­å®šå¤‰æ›´ï¼ˆæ…é‡ã«å®Ÿè¡Œï¼‰
# 1. é–‹ç™ºç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ
# 2. å‹•ä½œç¢ºèª
# 3. æœ¬ç•ªç’°å¢ƒã«é©ç”¨
# è©³ç´°ã¯ terraform/INFRASTRUCTURE_MANAGEMENT.md ã‚’å‚ç…§
```

### ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ•ãƒ­ãƒ¼

#### 1. CI/CDå¤±æ•—æ™‚
```bash
# 1. GitHub Actionsã®ãƒ­ã‚°ã‚’ç¢ºèª
# 2. æ¨©é™ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
#    - WIFè¨­å®šç¢ºèª
#    - Secret Managerã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ç¢ºèª
# 3. Terraformã‚¨ãƒ©ãƒ¼ã®å ´åˆ
#    - çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
#    - ãƒªã‚½ãƒ¼ã‚¹ç«¶åˆç¢ºèª
```

#### 2. ãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•—æ™‚
```bash
# 1. Firebase Hostingã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
firebase projects:list
firebase hosting:channel:list --project=rakugakimap-dev

# 2. æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã§ç¢ºèª
npm run deploy:dev
npm run deploy:prod
```

#### 3. ã‚¤ãƒ³ãƒ•ãƒ©å•é¡Œæ™‚
```bash
# 1. Terraformã‚¹ãƒ†ãƒ¼ãƒˆç¢ºèª
cd terraform/environments/dev
terraform state list
terraform plan

# 2. æ‰‹å‹•ãƒªã‚½ãƒ¼ã‚¹ç¢ºèª
gcloud projects list
gcloud secrets list --project=rakugakimap-dev
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

### 1. æ¨©é™ç®¡ç†
- **æœ€å°æ¨©é™ã®åŸå‰‡**: å¿…è¦æœ€å°é™ã®æ¨©é™ã®ã¿ä»˜ä¸
- **å®šæœŸçš„ãªæ¨©é™ç›£æŸ»**: ä¸è¦ãªæ¨©é™ã®å‰Šé™¤
- **ç’°å¢ƒåˆ†é›¢**: é–‹ç™ºãƒ»æœ¬ç•ªã®æ¨©é™ã‚’æ˜ç¢ºã«åˆ†é›¢

### 2. æ©Ÿå¯†æƒ…å ±ç®¡ç†
- **Secret Managerä½¿ç”¨**: ã™ã¹ã¦ã®æ©Ÿå¯†æƒ…å ±ã‚’Secret Managerã§ç®¡ç†
- **GitHub Secretsç¦æ­¢**: æ©Ÿå¯†æƒ…å ±ã‚’GitHub Secretsã«ä¿å­˜ã—ãªã„
- **ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ**: `.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ï¼ˆgitignoreå¯¾è±¡ï¼‰

### 3. ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **WIFèªè¨¼**: GitHub Actionsã¯Workload Identity Federationã‚’ä½¿ç”¨
- **2æ®µéšèªè¨¼**: æœ¬ç•ªç’°å¢ƒã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯è¿½åŠ ç¢ºèªãŒå¿…è¦
- **ç›£æŸ»ãƒ­ã‚°**: ã™ã¹ã¦ã®æœ¬ç•ªç’°å¢ƒæ“ä½œã‚’ãƒ­ã‚°ã«è¨˜éŒ²

## å“è³ªä¿è¨¼

### 1. è‡ªå‹•ãƒã‚§ãƒƒã‚¯
- **Lint**: ESLintã€Prettierã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
- **Type Check**: TypeScriptã«ã‚ˆã‚‹å‹å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯
- **Security Scan**: detect-secretsã«ã‚ˆã‚‹ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæ¼æ´©ãƒã‚§ãƒƒã‚¯

### 2. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
```bash
# ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆçŠ¶æ³: ãƒ†ã‚¹ãƒˆãªã—
# ä»Šå¾Œã®è¿½åŠ äºˆå®š:
# - Unit Tests: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
# - Integration Tests: Firebaseé€£æºãƒ†ã‚¹ãƒˆ
# - E2E Tests: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ
```

### 3. ãƒ‡ãƒ—ãƒ­ã‚¤æ¤œè¨¼
- **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒ**: Pull Requestæ¯ã®å‹•ä½œç¢ºèª
- **é–‹ç™ºç’°å¢ƒ**: mainãƒ–ãƒ©ãƒ³ãƒãƒãƒ¼ã‚¸å¾Œã®çµ±åˆãƒ†ã‚¹ãƒˆ
- **æœ¬ç•ªç’°å¢ƒ**: ã‚¿ã‚°ä½œæˆå¾Œã®æœ€çµ‚ç¢ºèª

## ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ»é‹ç”¨

### 1. ç›£è¦–é …ç›®
- **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**: Firebase Hostingã®ç¨¼åƒçŠ¶æ³
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Firestoreã®ä½¿ç”¨é‡ãƒ»ã‚¨ãƒ©ãƒ¼ç‡
- **API**: Google Maps APIã®ä½¿ç”¨é‡ãƒ»åˆ¶é™çŠ¶æ³

### 2. ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
- **ä½¿ç”¨é‡ã‚¢ãƒ©ãƒ¼ãƒˆ**: APIåˆ¶é™ã®80%åˆ°é”æ™‚
- **ã‚¨ãƒ©ãƒ¼ã‚¢ãƒ©ãƒ¼ãƒˆ**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆ**: ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹æ¤œçŸ¥æ™‚

### 3. å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
```bash
# æœˆæ¬¡ä½œæ¥­
# 1. ä¾å­˜é–¢ä¿‚ã®æ›´æ–°ç¢ºèª
npm audit
npm outdated

# 2. APIä½¿ç”¨é‡ç¢ºèª
# Google Cloud Consoleã§ç¢ºèª

# 3. ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª
# GitHub Actionsãƒ­ã‚°ã®æ•´ç†
```

## ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †

### 1. é–‹ç™ºå•é¡Œ
1. **ãƒ¬ãƒ™ãƒ«1**: é–‹ç™ºè€…ã«ã‚ˆã‚‹è‡ªå·±è§£æ±º
2. **ãƒ¬ãƒ™ãƒ«2**: ãƒãƒ¼ãƒ å†…ã§ã®æŠ€è¡“ç›¸è«‡
3. **ãƒ¬ãƒ™ãƒ«3**: å¤–éƒ¨æŠ€è¡“ã‚µãƒãƒ¼ãƒˆã¸ã®å•ã„åˆã‚ã›

### 2. ã‚¤ãƒ³ãƒ•ãƒ©å•é¡Œ
1. **ãƒ¬ãƒ™ãƒ«1**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ã«ã‚ˆã‚‹è§£æ±º
2. **ãƒ¬ãƒ™ãƒ«2**: GCPã‚µãƒãƒ¼ãƒˆã¸ã®å•ã„åˆã‚ã›
3. **ãƒ¬ãƒ™ãƒ«3**: ç·Šæ€¥å¯¾å¿œï¼ˆã‚µãƒ¼ãƒ“ã‚¹åœæ­¢æ™‚ï¼‰

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œ
1. **å³åº§å¯¾å¿œ**: è©²å½“ãƒªã‚½ãƒ¼ã‚¹ã®ä¸€æ™‚åœæ­¢
2. **èª¿æŸ»**: ãƒ­ã‚°åˆ†æãƒ»å½±éŸ¿ç¯„å›²ç‰¹å®š
3. **å¾©æ—§**: ä¿®æ­£ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–å¾Œã®å†é–‹

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [INFRASTRUCTURE_MANAGEMENT.md](terraform/INFRASTRUCTURE_MANAGEMENT.md) - ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†è©³ç´°
- [STATE_BUCKET_MANAGEMENT.md](terraform/STATE_BUCKET_MANAGEMENT.md) - ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚±ãƒƒãƒˆç®¡ç†
- [SECRET_MANAGEMENT.md](terraform/SECRET_MANAGEMENT.md) - ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†
- [CLAUDE.md](CLAUDE.md) - Claude Codeå‘ã‘é–‹ç™ºã‚¬ã‚¤ãƒ‰
- [README.md](README.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ãƒ»ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

## æ›´æ–°å±¥æ­´

- 2025-06-28: åˆç‰ˆä½œæˆï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†å¯¾å¿œï¼‰
